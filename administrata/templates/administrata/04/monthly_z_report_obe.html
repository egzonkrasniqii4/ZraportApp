<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Z Report</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: Arial, sans-serif;
            font-size: 13px;
            background: linear-gradient(135deg, hsl(47, 70%, 91%), #6161617e);
            color: #333;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            background: #fff;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .edit-button {
            display: inline-block;
            background-color: rgba(0, 0, 0, 0.568); /* Bootstrap primary color */
            color: #fff;
            padding: 5px 10px;
            font-size: 12px;
            border: none;
            border-radius: 3px;
            text-decoration: none;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .edit-button:hover {
            background-color: rgba(0, 0, 0, 0.1); /* Darker shade for hover */
        }

        h1 {
            text-align: center;
            color: #414040;
            margin-bottom: 10px;
            font-size: 20px;
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        label {
            font-weight: bold;
            color: #555;
            margin-bottom: 1px;
        }

        input[type="month"], input[type="text"], select {
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
            width: 100%;
            box-shadow: inset 0 1px 5px rgba(19, 18, 18, 0.1);
        }

        input[type="submit"] {
            background-color: #252627;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        input[type="submit"]:hover {
            background-color: #454545;
        }

        .corner-button {
            position: fixed; /* Keeps it in the same corner regardless of scroll */
            bottom: 10px; /* Adjust distance from the bottom */
            right: 10px; /* Adjust distance from the right */
            padding: 5px 10px; /* Smaller size */
            font-size: 12px; /* Smaller font */
            background-color: #f0f0f0; /* Neutral color */
            color: #333; /* Subtle text */
            border: 1px solid #ccc; /* Light border */
            border-radius: 5px; /* Rounded corners for softer look */
            box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2); /* Slight shadow for depth */
            cursor: pointer;
            opacity: 0.8; /* Slightly transparent */
            transition: opacity 0.3s ease; /* Smooth hover effect */
        }
        
        .corner-button:hover {
            opacity: 1; /* Fully visible on hover */
            background-color: #e0e0e0; /* Slightly darker on hover */
        }

        .results {
            margin-top: 30px;
            max-height: 400px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            font-size: 14px;
        }

        th {
            background-color: #f2f2f2;
            color: #333;
            font-size: 16px;
            padding: 5px;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        .no-records {
            text-align: center;
            font-style: italic;
            color: #888;
            margin-top: 20px;
        }

        .photo-link {
            color: #007BFF; /* Bootstrap primary color */
            text-decoration: none; /* Remove underline */
        }

        .photo-link:hover {
            text-decoration: underline; /* Underline on hover */
        }

        button[name="export"] {
            background-color: #4CAF50; /* Green background */
            color: white; /* White text */
            border: none; /* No border */
            padding: 10px 15px; /* Padding for size */
            font-size: 14px; /* Font size */
            border-radius: 5px; /* Rounded corners */
            cursor: pointer; /* Pointer cursor on hover */
            transition: background-color 0.3s ease, transform 0.2s ease; /* Smooth hover effect */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* Subtle shadow */
        }

        button[name="export"]:hover {
            background-color: #45a049; /* Darker green on hover */
            transform: scale(1.05); /* Slightly enlarge on hover */
        }

        button[name="export"]:active {
            background-color: #3e8e41; /* Even darker green when clicked */
            transform: scale(1); /* Reset scale on click */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Monthly Z Report</h1>
        <form method="GET" action="{% url 'monthly_z_report_dndo' %}">
            <!-- Month Selection -->
             <!-- From Month Selection -->
            <!-- From Month -->
        <label for="fromMonth">From Month:</label>
        <input type="month" id="fromMonth" name="from_month" value="{{ selected_from_month|default:today|date:'Y-m' }}" required>

            <!-- To Month -->
        <label for="toMonth">To Month:</label>
        <input type="month" id="toMonth" name="to_month" value="{{ selected_to_month|default:today|date:'Y-m' }}" required>
            <!-- Location Filter -->
            <label for="locationFilter">Location:</label>
            <input type="text" id="locationFilter" name="location" value="{{ selected_location }}" placeholder="Enter location code">
            
            <input type="submit" value="Generate Report">
            <button type="submit" name="export" value="excel">Export to Excel</button>
            <button type="submit" name="run_procedure" value="true" class="danger-button corner-button" onclick="runProcedure()">Run Procedure</button>

        </form>
        
        <div class="results">
            {% if records %}
                <table>
                    <thead>
                        <tr>
                            <th onclick="sortTable(0, this)">Location</th>
                            <th onclick="sortTable(1, this)">Store</th>
                            <th onclick="sortTable(2, this)">Month</th>
                            <th onclick="sortTable(3, this)">Sistemi</th>
                            <th onclick="sortTable(4, this)">Period Raport Z</th>
                            <th onclick="sortTable(5, this)">Other</th>
                            <th onclick="sortTable(6, this)">Difference</th>
                            <th>Photo</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for record in records %}
                            <tr>
                                <td>{{record.Location }}</td>
                                <td>{{record.Store}}</td>
                                <td>{{record.ReceivedMonth}}</td>  <!-- Ensure correct field is used here -->
                                <td>{{record.Sistemi}}</td>
                                <td>{{record.TotalValue }}</td>
                                <td>{{record.Other}}</td>
                                <td>{{record.Difference}}</td>
                                <td>
                                    {% if record.ImageData %}
                                    <a href="{{ record.ImageData }}" target="_blank">View Image</a>
                                    {% else %}
                                        No Photo
                                    {% endif %}
                                </td>

                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p class="no-records">No records found for the selected criteria.</p>
            {% endif %}
        </div>
    </div>
</body>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const today = new Date();
        const prevMonth = new Date(today.setMonth(today.getMonth() - 1));

        const formatMonth = (date) => {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            return `${year}-${month}`;
        };

        // Only set the month if the fields are empty
        const fromMonth = document.getElementById("fromMonth");
        const toMonth = document.getElementById("toMonth");

        if (!fromMonth.value) {
            fromMonth.value = formatMonth(prevMonth);
        }

        if (!toMonth.value) {
            toMonth.value = formatMonth(prevMonth);
        }
    });

    function runProcedure() {
        // Add logic to trigger procedure or show confirmation
        alert("Procedure executed successfully!");
    } 

    function sortTable(columnIndex, th) {
        var table, rows, switching, i, x, y, shouldSwitch, direction, switchCount = 0;
        table = document.querySelector("table");
        switching = true;
        direction = th.getAttribute("data-sort-direction") === "asc" ? "desc" : "asc";  // Toggle direction
        th.setAttribute("data-sort-direction", direction);  // Update attribute for next click

        while (switching) {
            switching = false;
            rows = table.rows;

            for (i = 1; i < (rows.length - 1); i++) {
                shouldSwitch = false;
                x = rows[i].getElementsByTagName("TD")[columnIndex];
                y = rows[i + 1].getElementsByTagName("TD")[columnIndex];

                if (direction == "asc") {
                    if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                        shouldSwitch = true;
                        break;
                    }
                } else if (direction == "desc") {
                    if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                        shouldSwitch = true;
                        break;
                    }
                }
            }

            if (shouldSwitch) {
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
                switchCount++;
            } else {
                if (switchCount == 0 && direction == "asc") {
                    direction = "desc";
                    switching = true;
                }
            }
        }
    }
</script>


</html>
